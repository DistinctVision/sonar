option(OPENCV_ENABLE "Include opencv in project" ON)
if (OPENCV_ENABLE)
  if (LINUX OR WIN32)
    if (DEBUG_TOOLS_ENABLED)
      find_package(OpenCV REQUIRED COMPONENTS core imgproc flann calib3d aruco video videoio highgui imgcodecs)
    else()
      find_package(OpenCV REQUIRED COMPONENTS core imgproc flann calib3d aruco)
    endif()
    include_directories(${OpenCV_INCLUDE_DIRS})
    target_link_libraries(sonar ${OpenCV_LIBS})
  else()
    set(OpenCV_INCLUDE_DIR "" CACHE FILEPATH "Directory of opencv include files")
    set(OpenCV_LIB_DIR "" CACHE FILEPATH "Directory of opencv libraries")
    if (${OpenCV_INCLUDE_DIR} STREQUAL "")
      message(FATAL_ERROR "Directory of opencv include files directory is not set")
    elseif (NOT (EXISTS "${OpenCV_INCLUDE_DIR}" AND IS_DIRECTORY "${OpenCV_INCLUDE_DIR}"))
      message(FATAL_ERROR "Invalid directory of opencv include files")
    endif()
    if (${OpenCV_LIB_DIR} STREQUAL "")
      message(FATAL_ERROR "Directory of opencv libraries is not set")
    elseif (NOT (EXISTS "${OpenCV_LIB_DIR}" AND IS_DIRECTORY "${OpenCV_LIB_DIR}"))
      message(FATAL_ERROR "Invalid directory of opencv libraries")
    endif()
    include_directories(${OpenCV_INCLUDE_DIR})
    if (DEBUG_TOOLS_ENABLED)
      target_link_libraries(sonar -L${OpenCV_LIB_DIR} opencv_core opencv_imgproc opencv_flann opencv_calib3d opencv_aruco opencv_video opencv_videoio opencv_highgui opencv_imgcodecs)
    else()
      target_link_libraries(sonar -L${OpenCV_LIB_DIR} opencv_core opencv_imgproc opencv_flann opencv_calib3d opencv_aruco)
    endif()
  endif()
  add_definitions(-DOPENCV_LIB)
endif()
